<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MaBoutique ‚Äì Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="color-scheme" content="light dark" />
  </head>
  <body class="bg-gray-50 text-gray-800">
    <!-- Top Announcement Bar -->
    <div class="bg-indigo-600 text-white text-sm">
      <div
        class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-center gap-4 text-center"
      >
        <span>üöö Livraison offerte d√®s 50‚Ç¨</span>
        <span class="hidden sm:inline">‚Ü©Ô∏è Retours gratuits sous 30 jours</span>
        <span class="hidden md:inline">üîí Paiement 100% s√©curis√©</span>
      </div>
    </div>

    <!-- Header -->
    <header class="bg-white sticky top-0 z-50 border-b">
      <div class="max-w-7xl mx-auto px-4 py-4 flex items-center gap-4">
        <!-- Logo -->
        <a
          href="#"
          class="text-2xl font-extrabold tracking-tight text-indigo-700"
          >MaBoutique</a
        >

        <!-- Categories (Desktop) -->
        <nav class="hidden lg:flex items-center gap-6 ml-2">
          <button
            data-cat="all"
            class="cat-link text-gray-700 hover:text-indigo-600"
          >
            Tout
          </button>
          <button
            data-cat="V√™tements"
            class="cat-link text-gray-700 hover:text-indigo-600"
          >
            V√™tements
          </button>
          <button
            data-cat="√âlectronique"
            class="cat-link text-gray-700 hover:text-indigo-600"
          >
            √âlectronique
          </button>
          <button
            data-cat="Maison"
            class="cat-link text-gray-700 hover:text-indigo-600"
          >
            Maison
          </button>
          <button
            data-cat="Accessoires"
            class="cat-link text-gray-700 hover:text-indigo-600"
          >
            Accessoires
          </button>
        </nav>

        <!-- Search -->
        <div class="flex-1 flex items-center">
          <div class="relative w-full max-w-xl ml-auto">
            <input
              id="search"
              type="text"
              placeholder="Rechercher des produits..."
              class="w-full border border-gray-300 rounded-xl pl-10 pr-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            />
            <svg
              class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-4.35-4.35M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"
              />
            </svg>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex items-center gap-3">
          <!-- Favoris -->
          <button
            id="btn-favoris"
            class="p-2 rounded-lg hover:bg-gray-100 flex items-center justify-center"
            title="Favoris"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-8 h-8 text-gray-700 mt-2"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034.958 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l.958-3.292-2.8-2.034c-.783-.57-.38-1.81.588-1.81h3.462l1.07-3.292z"
              />
            </svg>
          </button>

          <!-- Compte -->
          <button
            id="btn-account"
            class="p-2 rounded-lg hover:bg-gray-100"
            title="Compte"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6 text-gray-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5zm0 2c-4 0-8 2-8 6h16c0-4-4-6-8-6z"
              />
            </svg>
          </button>

          <!-- Panier -->
          <button
            id="cart-button"
            class="relative p-2 rounded-lg hover:bg-gray-100"
            title="Panier"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6 text-gray-700"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 3h2l.4 2m2.6 10h10l4-8H6.4m0 0L5 5m1.4 10L4 22m12-7l2 7m-6 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm8 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"
              />
            </svg>
            <span
              id="cart-count"
              class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full px-1"
              >0</span
            >
          </button>
        </div>
      </div>
    </header>

    <!-- Hero -->
    <section
      class="relative bg-gradient-to-tr from-indigo-600 to-blue-500 text-white"
    >
      <div
        class="max-w-7xl mx-auto px-4 py-16 grid md:grid-cols-2 gap-8 items-center"
      >
        <div>
          <p class="uppercase tracking-widest text-white/80 text-xs mb-2">
            Nouvelle saison
          </p>
          <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
            Style, Tech & Maison ‚Äî tout ce que vous aimez
          </h1>
          <p class="mt-4 text-white/90 max-w-prose">
            D√©couvrez nos nouveaut√©s et promos du moment. Livraison offerte d√®s
            50‚Ç¨ et retours gratuits.
          </p>
          <div class="mt-6 flex gap-3">
            <a
              href="#catalogue"
              class="inline-block bg-white text-indigo-700 font-semibold px-6 py-3 rounded-xl hover:bg-gray-100"
              >Voir le catalogue</a
            >
            <a
              href="#promos"
              class="inline-block bg-indigo-800/40 text-white font-semibold px-6 py-3 rounded-xl ring-1 ring-white/30 hover:bg-indigo-800/60"
              >Promotions</a
            >
          </div>
        </div>
        <div class="hidden md:block">
          <img
            alt="Hero"
            class="w-full h-auto rounded-2xl shadow-xl ring-1 ring-white/20"
            src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1600&auto=format&fit=crop"
          />
        </div>
      </div>
    </section>

    <!-- Filters + Sort -->
    <section id="catalogue" class="max-w-7xl mx-auto px-4 py-8">
      <div class="bg-white rounded-2xl shadow p-4 md:p-6">
        <div class="flex flex-wrap items-end gap-4">
          <!-- Category -->
          <div>
            <label class="block text-sm text-gray-600 mb-1">Cat√©gorie</label>
            <select
              id="category"
              class="border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            >
              <option value="all">Toutes</option>
              <option>V√™tements</option>
              <option>√âlectronique</option>
              <option>Maison</option>
              <option>Accessoires</option>
            </select>
          </div>
          <!-- Price -->
          <div class="flex items-end gap-3">
            <div>
              <label class="block text-sm text-gray-600 mb-1"
                >Prix min (‚Ç¨)</label
              >
              <input
                type="number"
                id="priceMin"
                class="w-28 border rounded-xl px-3 py-2"
                min="0"
                step="0.01"
                placeholder="0"
              />
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1"
                >Prix max (‚Ç¨)</label
              >
              <input
                type="number"
                id="priceMax"
                class="w-28 border rounded-xl px-3 py-2"
                min="0"
                step="0.01"
                placeholder="999"
              />
            </div>
          </div>
          <!-- Toggles -->
          <div class="flex items-center gap-2">
            <label class="inline-flex items-center gap-2 select-none">
              <input id="filterNew" type="checkbox" class="rounded" />
              <span>Nouveaut√©s</span>
            </label>
            <label class="inline-flex items-center gap-2 select-none">
              <input id="filterPromo" type="checkbox" class="rounded" />
              <span>Promos</span>
            </label>
          </div>
          <!-- Sort -->
          <div class="ml-auto">
            <label class="block text-sm text-gray-600 mb-1">Trier par</label>
            <select
              id="sort"
              class="border rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            >
              <option value="relevance">Pertinence</option>
              <option value="priceAsc">Prix : croissant</option>
              <option value="priceDesc">Prix : d√©croissant</option>
              <option value="popularity">Popularit√©</option>
              <option value="newest">Nouveaut√©s</option>
            </select>
          </div>
        </div>
        <div class="mt-4 text-sm text-gray-500">
          <span id="result-count">0</span> articles
        </div>
      </div>
    </section>

    <!-- Products Grid -->
    <section class="max-w-7xl mx-auto px-4 pb-12">
      <div
        id="products"
        class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
      ></div>
    </section>

    <!-- Promotions strip -->
    <section id="promos" class="max-w-7xl mx-auto px-4 pb-12">
      <div
        class="bg-gradient-to-r from-pink-500 to-rose-500 rounded-2xl p-6 sm:p-8 text-white flex flex-col sm:flex-row items-center justify-between gap-4"
      >
        <div>
          <h3 class="text-2xl font-bold">-20% sur une s√©lection</h3>
          <p class="text-white/90">
            Utilisez le code
            <span class="font-mono bg-white/20 px-2 py-0.5 rounded"
              >WELCOME20</span
            >
            √† la caisse
          </p>
        </div>
        <a
          href="#catalogue"
          class="bg-white text-rose-600 font-semibold px-6 py-3 rounded-xl hover:bg-gray-100"
          >J'en profite</a
        >
      </div>
    </section>

    <!-- Footer -->
    <footer class="border-t bg-white">
      <div
        class="max-w-7xl mx-auto px-4 py-10 grid grid-cols-2 sm:grid-cols-4 gap-8 text-sm"
      >
        <div>
          <h4 class="font-semibold mb-3">MaBoutique</h4>
          <p class="text-gray-600">
            Style, Tech & Maison. Livraison rapide et retours faciles.
          </p>
        </div>
        <div>
          <h4 class="font-semibold mb-3">Aide</h4>
          <ul class="space-y-2 text-gray-600">
            <li>
              <a href="#" class="hover:text-indigo-600">Service client</a>
            </li>
            <li>
              <a href="#" class="hover:text-indigo-600">Suivi de commande</a>
            </li>
            <li><a href="#" class="hover:text-indigo-600">Retours</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">L√©gal</h4>
          <ul class="space-y-2 text-gray-600">
            <li><a href="#" class="hover:text-indigo-600">CGV</a></li>
            <li>
              <a href="#" class="hover:text-indigo-600">Confidentialit√©</a>
            </li>
            <li><a href="#" class="hover:text-indigo-600">Cookies</a></li>
          </ul>
        </div>
        <div>
          <h4 class="font-semibold mb-3">Newsletter</h4>
          <div class="flex gap-2">
            <input
              type="email"
              placeholder="Votre email"
              class="flex-1 border rounded-xl px-3 py-2"
            />
            <button class="bg-indigo-600 text-white px-4 py-2 rounded-xl">
              S'inscrire
            </button>
          </div>
        </div>
      </div>
      <div class="text-center text-xs text-gray-500 pb-6">
        ¬© <span id="year"></span> MaBoutique. Tous droits r√©serv√©s.
      </div>
    </footer>

    <!-- Cart Drawer -->
    <div id="cart-drawer" class="fixed inset-0 z-[60] hidden">
      <div class="absolute inset-0 bg-black/40" id="cart-overlay"></div>
      <aside
        class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl flex flex-col translate-x-full transition-transform"
        id="cart-panel"
      >
        <div class="p-4 border-b flex items-center justify-between">
          <h3 class="text-lg font-semibold">Mon Panier</h3>
          <button
            id="cart-close"
            class="p-2 rounded-lg hover:bg-gray-100"
            aria-label="Fermer"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>
        <div class="p-4 overflow-y-auto flex-1">
          <ul id="cart-items" class="space-y-3"></ul>
        </div>
        <div class="p-4 border-t space-y-2">
          <div class="flex justify-between text-sm text-gray-600">
            <span>Sous-total</span><span id="subtotal">0,00¬†‚Ç¨</span>
          </div>
          <div class="flex justify-between text-base font-semibold">
            <span>Total</span><span id="cart-total">0,00¬†‚Ç¨</span>
          </div>
          <button
            class="w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700"
          >
            Passer la commande
          </button>
        </div>
      </aside>
    </div>

    <script>
      // ==== DATA ====
      const products = [
        {
          id: 1,
          name: "T-shirt noir Premium",
          price: 19.99,
          category: "V√™tements",
          rating: 4.5,
          popularity: 92,
          isNew: true,
          isPromo: false,
          discount: 0,
          createdAt: "2025-08-01",
          image: "https://source.unsplash.com/600x600/?tshirt",
        },
        {
          id: 2,
          name: "Casque Bluetooth Pro",
          price: 79.9,
          category: "√âlectronique",
          rating: 4.7,
          popularity: 98,
          isNew: true,
          isPromo: true,
          discount: 15,
          createdAt: "2025-07-20",
          image: "https://source.unsplash.com/600x600/?headphones",
        },
        {
          id: 3,
          name: "Mug c√©ramique design",
          price: 12.5,
          category: "Maison",
          rating: 4.2,
          popularity: 70,
          isNew: false,
          isPromo: false,
          discount: 0,
          createdAt: "2025-05-12",
          image: "https://source.unsplash.com/600x600/?mug",
        },
        {
          id: 4,
          name: "Sweat √† capuche Unisexe",
          price: 34.9,
          category: "V√™tements",
          rating: 4.6,
          popularity: 85,
          isNew: false,
          isPromo: true,
          discount: 20,
          createdAt: "2025-06-02",
          image: "https://source.unsplash.com/600x600/?hoodie",
        },
        {
          id: 5,
          name: "Lampe de bureau LED",
          price: 29.99,
          category: "Maison",
          rating: 4.1,
          popularity: 64,
          isNew: false,
          isPromo: false,
          discount: 0,
          createdAt: "2025-02-10",
          image: "https://source.unsplash.com/600x600/?desk-lamp",
        },
        {
          id: 6,
          name: "Montre connect√©e Sport",
          price: 99.0,
          category: "√âlectronique",
          rating: 4.4,
          popularity: 90,
          isNew: true,
          isPromo: false,
          discount: 0,
          createdAt: "2025-08-05",
          image: "https://source.unsplash.com/600x600/?smartwatch",
        },
        {
          id: 7,
          name: "Chaussures running Air",
          price: 59.0,
          category: "V√™tements",
          rating: 4.3,
          popularity: 76,
          isNew: false,
          isPromo: true,
          discount: 10,
          createdAt: "2025-03-29",
          image: "https://source.unsplash.com/600x600/?running-shoes",
        },
        {
          id: 8,
          name: "Enceinte portable",
          price: 39.99,
          category: "√âlectronique",
          rating: 4.0,
          popularity: 73,
          isNew: false,
          isPromo: false,
          discount: 0,
          createdAt: "2025-04-14",
          image: "https://source.unsplash.com/600x600/?speaker",
        },
        {
          id: 9,
          name: "Housse de coussin",
          price: 14.9,
          category: "Maison",
          rating: 4.1,
          popularity: 58,
          isNew: true,
          isPromo: false,
          discount: 0,
          createdAt: "2025-07-30",
          image: "https://source.unsplash.com/600x600/?pillow",
        },
        {
          id: 10,
          name: "Sac √† dos urbain",
          price: 44.9,
          category: "Accessoires",
          rating: 4.5,
          popularity: 82,
          isNew: true,
          isPromo: true,
          discount: 25,
          createdAt: "2025-06-25",
          image: "https://source.unsplash.com/600x600/?backpack",
        },
        {
          id: 11,
          name: "Bouteille isotherme",
          price: 24.0,
          category: "Accessoires",
          rating: 4.2,
          popularity: 60,
          isNew: false,
          isPromo: false,
          discount: 0,
          createdAt: "2025-01-18",
          image: "https://source.unsplash.com/600x600/?water-bottle",
        },
        {
          id: 12,
          name: "Tapis d√©coratif",
          price: 69.0,
          category: "Maison",
          rating: 4.6,
          popularity: 88,
          isNew: false,
          isPromo: true,
          discount: 30,
          createdAt: "2025-05-22",
          image: "https://source.unsplash.com/600x600/?rug",
        },
      ];

      // ==== STATE ====
      const els = {
        products: document.getElementById("products"),
        resultCount: document.getElementById("result-count"),
        search: document.getElementById("search"),
        category: document.getElementById("category"),
        priceMin: document.getElementById("priceMin"),
        priceMax: document.getElementById("priceMax"),
        filterNew: document.getElementById("filterNew"),
        filterPromo: document.getElementById("filterPromo"),
        sort: document.getElementById("sort"),
        year: document.getElementById("year"),
        cartBtn: document.getElementById("cart-button"),
        cartCount: document.getElementById("cart-count"),
        cartDrawer: document.getElementById("cart-drawer"),
        cartOverlay: document.getElementById("cart-overlay"),
        cartPanel: document.getElementById("cart-panel"),
        cartClose: document.getElementById("cart-close"),
        cartItems: document.getElementById("cart-items"),
        subtotal: document.getElementById("subtotal"),
        cartTotal: document.getElementById("cart-total"),
        catLinks: document.querySelectorAll(".cat-link"),
      };

      const state = {
        filters: {
          q: "",
          category: "all",
          priceMin: 0,
          priceMax: Infinity,
          onlyNew: false,
          onlyPromo: false,
        },
        sort: "relevance",
        cart: [], // {id, qty}
      };

      // Utilities
      const formatEUR = (n) =>
        n.toLocaleString("fr-FR", { style: "currency", currency: "EUR" });
      const parsePrice = (v) =>
        isNaN(parseFloat(v)) ? undefined : parseFloat(v);

      // Init price bounds
      const minPrice = Math.min(
        ...products.map((p) =>
          p.isPromo ? p.price * (1 - p.discount / 100) : p.price
        )
      );
      const maxPrice = Math.max(...products.map((p) => p.price));
      els.priceMin.placeholder = Math.floor(minPrice).toString();
      els.priceMax.placeholder = Math.ceil(maxPrice).toString();

      // Render stars
      function stars(r) {
        const full = Math.floor(r),
          half = r - full >= 0.5;
        let out = "";
        for (let i = 0; i < 5; i++) {
          if (i < full) {
            out += `<svg class="w-4 h-4 inline text-yellow-400" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.88 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
          } else if (i === full && half) {
            out += `<svg class="w-4 h-4 inline text-yellow-400" viewBox="0 0 24 24" fill="currentColor"><defs><linearGradient id="g"><stop offset="50%"/><stop offset="50%" stop-color="transparent"/></linearGradient></defs><path d="M12 .587l3.668 7.431 8.2 1.192-5.934 5.786 1.4 8.164L12 18.896 4.666 23.16l1.4-8.164L.132 9.21l8.2-1.192L12 .587z"/></svg>`;
          } else {
            out += `<svg class="w-4 h-4 inline text-gray-300" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.88 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>`;
          }
        }
        return out;
      }

      // ==== RENDER PRODUCTS ====
      function applyFilters(list) {
        const f = state.filters;
        return list.filter((p) => {
          const q = f.q ? p.name.toLowerCase().includes(f.q) : true;
          const cat = f.category === "all" ? true : p.category === f.category;
          const effPrice = p.isPromo
            ? p.price * (1 - p.discount / 100)
            : p.price;
          const min = f.priceMin !== undefined ? effPrice >= f.priceMin : true;
          const max = f.priceMax !== undefined ? effPrice <= f.priceMax : true;
          const onlyNew = f.onlyNew ? p.isNew : true;
          const onlyPromo = f.onlyPromo ? p.isPromo : true;
          return q && cat && min && max && onlyNew && onlyPromo;
        });
      }

      function applySort(list) {
        const s = state.sort;
        const arr = [...list];
        switch (s) {
          case "priceAsc":
            arr.sort(
              (a, b) =>
                (a.isPromo ? a.price * (1 - a.discount / 100) : a.price) -
                (b.isPromo ? b.price * (1 - b.discount / 100) : b.price)
            );
            break;
          case "priceDesc":
            arr.sort(
              (a, b) =>
                (b.isPromo ? b.price * (1 - b.discount / 100) : b.price) -
                (a.isPromo ? a.price * (1 - a.discount / 100) : a.price)
            );
            break;
          case "popularity":
            arr.sort((a, b) => b.popularity - a.popularity);
            break;
          case "newest":
            arr.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            break;
          default:
            /* relevance: popularity then newest */ arr.sort(
              (a, b) =>
                b.popularity - a.popularity ||
                new Date(b.createdAt) - new Date(a.createdAt)
            );
            break;
        }
        return arr;
      }

      function renderProducts() {
        const list = applySort(applyFilters(products));
        els.resultCount.textContent = list.length.toString();
        els.products.innerHTML = "";
        list.forEach((p) => {
          const eff = p.isPromo ? p.price * (1 - p.discount / 100) : p.price;
          const card = document.createElement("article");
          card.className =
            "group bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden flex flex-col";
          card.innerHTML = `
          <div class="relative">
            <img src="${p.image}" alt="${
            p.name
          }" class="w-full h-48 object-cover">
            <div class="absolute top-3 left-3 flex gap-2">
              ${
                p.isNew
                  ? '<span class="bg-emerald-600 text-white text-xs px-2 py-1 rounded-full">Nouveau</span>'
                  : ""
              }
              ${
                p.isPromo
                  ? '<span class="bg-rose-600 text-white text-xs px-2 py-1 rounded-full">-' +
                    p.discount +
                    "%</span>"
                  : ""
              }
            </div>
          </div>
          <div class="p-4 flex-1 flex flex-col">
            <h3 class="font-semibold leading-snug group-hover:text-indigo-600">${
              p.name
            }</h3>
            <div class="mt-1 text-xs text-gray-500">${p.category}</div>
            <div class="mt-2">${stars(p.rating)}</div>
            <div class="mt-3 flex items-center gap-2">
              ${
                p.isPromo
                  ? `<span class="text-lg font-bold text-rose-600">${formatEUR(
                      eff
                    )}</span><span class="text-sm text-gray-400 line-through">${formatEUR(
                      p.price
                    )}</span>`
                  : `<span class="text-lg font-bold text-indigo-700">${formatEUR(
                      p.price
                    )}</span>`
              }
            </div>
            <div class="mt-auto pt-4">
              <button data-add="${
                p.id
              }" class="w-full bg-indigo-600 text-white py-2.5 rounded-xl font-semibold hover:bg-indigo-700">Ajouter au panier</button>
            </div>
          </div>`;
          els.products.appendChild(card);
        });
      }

      // ==== CART ====
      function openCart() {
        els.cartDrawer.classList.remove("hidden");
        requestAnimationFrame(() => {
          els.cartPanel.classList.remove("translate-x-full");
        });
      }
      function closeCart() {
        els.cartPanel.classList.add("translate-x-full");
        setTimeout(() => els.cartDrawer.classList.add("hidden"), 200);
      }

      function addToCart(id) {
        const item = state.cart.find((i) => i.id === id);
        if (item) item.qty++;
        else state.cart.push({ id, qty: 1 });
        updateCart();
      }
      function removeFromCart(id) {
        state.cart = state.cart.filter((i) => i.id !== id);
        updateCart();
      }
      function setQty(id, qty) {
        const it = state.cart.find((i) => i.id === id);
        if (!it) return;
        it.qty = Math.max(1, qty);
        updateCart();
      }

      function updateCart() {
        els.cartItems.innerHTML = "";
        let total = 0;
        state.cart.forEach(({ id, qty }) => {
          const p = products.find((x) => x.id === id);
          const unit = p.isPromo ? p.price * (1 - p.discount / 100) : p.price;
          const line = unit * qty;
          total += line;
          const li = document.createElement("li");
          li.className = "flex items-center gap-3 border rounded-xl p-3";
          li.innerHTML = `
          <img src="${p.image}" alt="${
            p.name
          }" class="w-16 h-16 object-cover rounded-lg">
          <div class="flex-1">
            <div class="font-medium">${p.name}</div>
            <div class="text-sm text-gray-500">${formatEUR(unit)} ¬∑ ${
            p.category
          }</div>
            <div class="mt-2 flex items-center gap-2">
              <button data-dec="${
                p.id
              }" class="w-8 h-8 rounded-lg border flex items-center justify-center">‚Äì</button>
              <input data-qty="${
                p.id
              }" type="number" min="1" value="${qty}" class="w-14 text-center border rounded-lg py-1">
              <button data-inc="${
                p.id
              }" class="w-8 h-8 rounded-lg border flex items-center justify-center">+</button>
            </div>
          </div>
          <div class="flex flex-col items-end gap-2">
            <div class="font-semibold">${formatEUR(line)}</div>
            <button data-remove="${
              p.id
            }" class="text-rose-600 hover:underline text-sm">Retirer</button>
          </div>`;
          els.cartItems.appendChild(li);
        });
        els.subtotal.textContent = formatEUR(total);
        els.cartTotal.textContent = formatEUR(total);
        const count = state.cart.reduce((s, i) => s + i.qty, 0);
        els.cartCount.textContent = count;
      }

      // ==== EVENTS ====
      // Header category quick links
      els.catLinks.forEach((btn) => {
        btn.addEventListener("click", () => {
          const cat = btn.getAttribute("data-cat");
          state.filters.category = cat;
          els.category.value = cat === "all" ? "all" : cat;
          renderProducts();
          window.scrollTo({
            top: document.getElementById("catalogue").offsetTop - 80,
            behavior: "smooth",
          });
        });
      });

      // Filters
      els.search.addEventListener("input", () => {
        state.filters.q = els.search.value.trim().toLowerCase();
        renderProducts();
      });
      els.category.addEventListener("change", () => {
        state.filters.category = els.category.value;
        renderProducts();
      });
      els.priceMin.addEventListener("input", () => {
        state.filters.priceMin = parsePrice(els.priceMin.value);
        renderProducts();
      });
      els.priceMax.addEventListener("input", () => {
        state.filters.priceMax = parsePrice(els.priceMax.value);
        renderProducts();
      });
      els.filterNew.addEventListener("change", () => {
        state.filters.onlyNew = els.filterNew.checked;
        renderProducts();
      });
      els.filterPromo.addEventListener("change", () => {
        state.filters.onlyPromo = els.filterPromo.checked;
        renderProducts();
      });
      els.sort.addEventListener("change", () => {
        state.sort = els.sort.value;
        renderProducts();
      });

      // Delegate Add to cart from product grid
      els.products.addEventListener("click", (e) => {
        const btn = e.target.closest("button[data-add]");
        if (!btn) return;
        const id = parseInt(btn.getAttribute("data-add"), 10);
        addToCart(id);
        openCart();
      });

      // Cart drawer
      els.cartBtn.addEventListener("click", openCart);
      els.cartOverlay.addEventListener("click", closeCart);
      els.cartClose.addEventListener("click", closeCart);

      // Delegate cart actions
      els.cartItems.addEventListener("click", (e) => {
        const dec = e.target.closest("button[data-dec]");
        const inc = e.target.closest("button[data-inc]");
        const rm = e.target.closest("button[data-remove]");
        F;
        if (dec) {
          const id = +dec.getAttribute("data-dec");
          const it = state.cart.find((i) => i.id === id);
          if (it) {
            it.qty = Math.max(1, it.qty - 1);
            updateCart();
          }
        }
        if (inc) {
          const id = +inc.getAttribute("data-inc");
          const it = state.cart.find((i) => i.id === id);
          if (it) {
            it.qty = it.qty + 1;
            updateCart();
          }
        }
        if (rm) {
          const id = +rm.getAttribute("data-remove");
          removeFromCart(id);
        }
      });
      els.cartItems.addEventListener("input", (e) => {
        const qtyInput = e.target.closest("input[data-qty]");
        if (qtyInput) {
          const id = +qtyInput.getAttribute("data-qty");
          setQty(id, parseInt(qtyInput.value || "1", 10));
        }
      });

      // Footer year
      els.year.textContent = new Date().getFullYear();

      // Initial render
      renderProducts();
    </script>
  </body>
</html>
